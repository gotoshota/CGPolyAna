# CGPolyAna 要件定義

## 1. プログラムの目的と機能

### 基本モジュールの継承と機能拡張
- PBC wrap、lammpstrjパーサー、確率密度関数などの基本操作モジュール(src/modules/)を継承し、後輩が利用・拡張しやすいようにする。
- MSD、RDF、Rg2などの基本的な物理量計算を実装する。

### インターフェースの構築
- Python（または他の言語）でコマンドラインインターフェース(cgpa.py)を構築し、解析プログラムを容易に呼び出せるようにする。
- インターフェースは拡張性を考慮し、将来的な機能追加に対応できるようにする。

### 出力形式
- 基本的にはテキストファイルを出力する。
- 行列データなど、大規模なデータ出力にはHDF5形式を採用する。HDF5はバイナリ形式なのでテキストに比べ読み込み速度が速く、大規模データに適している。pythonのライブラリも充実しており、相性が良い。

### 機能追加
- 現状のexamplesディレクトリのプログラムを基本とし、必要に応じて機能を追加する。

## 2. インプットデータ

### LAMMPSトラジェクトリファイル
- インプットはLAMMPSのトラジェクトリファイル(*.lammpstrj)とtemplate.nmlファイルのみとする。

### template.nmlファイル
- 粗視化高分子の重合度、粒子数、トラジェクトリファイルパスなどの入力パラメータを記述する。

### インプットデータの規模
- 最大10万粒子、100億ステップ（10万スナップショット）を想定する。

## 3. プログラムの構成

### FortranとPythonの役割分担
- 解析処理はすべてFortranで行い、Pythonはインターフェースとして機能する。
- pythonインターフェースは、他の言語で置き換えてもいいように作成する。

### srcディレクトリのモジュール
- coord_convert.f90: 座標変換（PBC wrap、重心計算など）
- correlation_function.f90: 物理量（2次元配列）の相関関数計算
- global_types.f90: トラジェクトリ情報格納用構造体定義
- io.f90: lammpstrjファイルI/O
- math.f90: 基本的な数学演算
- physical_constants.f90: 物理定数定義
- statistics.f90: 平均、分散、確率密度関数計算
- string_utils.f90: io.f90補助（ヘッダー解析）
- error_handling.f90: エラー処理

### toolsディレクトリのスクリプト
- generate_polymerdata.py: 粗視化高分子のLAMMPSデータファイル生成
- log-parser: LAMMPSログファイル解析
- merge_lammpstrj: 分割されたlammpstrjファイル結合

### LammpsDumpReader
- Fortranで実装され、各exampleディレクトリでコンパイルして使用する。

### cgpa.py
- コマンドラインインターフェースとして機能する。

## 4. 開発環境と依存関係

### Fortranコンパイラ
- gfortranを基本とし、ifx、ifortranにも対応させる。

### Python環境
- uvを用いて依存関係を管理し、環境ファイルを生成する。

### 依存関係の明確化
- 必要な依存関係とそのインストール方法を明確にする。

## 5. テストとドキュメント

### テスト方針
- 単体テスト: 各モジュールの関数・サブルーチンを個別にテストする。Fortran Unit Test Framework(funit)などを用いる。
- 結合テスト: 複数のモジュールを組み合わせたテストや、cgpa.pyからの実行テストを行う。
- 回帰テスト: 過去の修正による影響がないかを確認するために、テストを自動化する。

### テストプログラム
- testディレクトリのテストプログラムを拡充し、Makefileで自動実行できるようにする。

### ドキュメント
- README、コード内のコメント、APIドキュメントなどを整備する。Doxygenなどを用いて、コード内のコメントからAPIドキュメントを自動生成する。

## 6. 引継ぎの要件

### 情報提供
- 各モジュールの関数・サブルーチンの入出力内容、Makefileの使い方、プログラムの拡張方法などをまとめたドキュメントを作成する。

### 後輩のスキルレベル
- 後輩のプログラミングスキルに合わせて、段階的に情報を提供する。

## 7. 提案

### バージョン管理
- GitHubなどのバージョン管理システムを利用し、コードの共有と管理を行う。

### 継続的インテグレーション
- 継続的インテグレーション(CI)ツール(GitHub Actions, GitLab CIなど)の導入を検討する。テストの自動化やドキュメント生成を自動化することで、開発効率と品質を向上させる。

### コードレビュー
- コードレビューを積極的に行い、コードの品質向上と知識共有を図る。
